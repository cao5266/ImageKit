# ImageKit æŠ€æœ¯å¼€å‘æ–‡æ¡£

## 1. æŠ€æœ¯æ¶æ„

### 1.1 æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ç”¨æˆ·æµè§ˆå™¨ï¼ˆClientï¼‰             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å‰ç«¯æ¡†æ¶ï¼šReact 18 + TypeScript        â”‚
â”‚  UIç»„ä»¶ï¼šshadcn/ui + TailwindCSS        â”‚
â”‚  çŠ¶æ€ç®¡ç†ï¼šZustand                       â”‚
â”‚  å›¾ç‰‡å¤„ç†ï¼šbrowser-image-compression     â”‚
â”‚            + Fabric.js + Canvas API     â”‚
â”‚  æ–‡ä»¶ç®¡ç†ï¼šreact-dropzone + JSZip       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         éƒ¨ç½²ï¼šVercelï¼ˆé™æ€æ‰˜ç®¡ï¼‰          â”‚
â”‚         åŸŸåï¼šimagekit.comï¼ˆå¾…å®šï¼‰       â”‚
â”‚         CDNï¼šVercel è‡ªå¸¦ CDN             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç‰¹ç‚¹ï¼š
- 100% å‰ç«¯å¤„ç†ï¼Œæ— åç«¯æœåŠ¡å™¨
- æ–‡ä»¶ä¸ä¸Šä¼ ï¼Œæœ¬åœ°å¤„ç†
- æˆæœ¬æä½ï¼ˆå‡ ä¹ä¸º0ï¼‰
```

### 1.2 æŠ€æœ¯æ ˆé€‰å‹

| æŠ€æœ¯åˆ†ç±» | é€‰å‹ | ç‰ˆæœ¬ | ç†ç”± |
|---------|------|------|------|
| **å‰ç«¯æ¡†æ¶** | React | 18.x | ç”Ÿæ€æˆç†Ÿã€ç»„ä»¶åŒ–ã€æ€§èƒ½å¥½ |
| **ç±»å‹æ£€æŸ¥** | TypeScript | 5.x | ç±»å‹å®‰å…¨ã€å‡å°‘ bug |
| **æ„å»ºå·¥å…·** | Vite | 5.x | å¿«é€Ÿã€ç°ä»£åŒ– |
| **UIç»„ä»¶** | shadcn/ui | latest | ç°ä»£ã€ç¾è§‚ã€å¯å®šåˆ¶ |
| **CSSæ¡†æ¶** | TailwindCSS | 3.x | å¿«é€Ÿå¼€å‘ã€ä¸€è‡´æ€§å¥½ |
| **çŠ¶æ€ç®¡ç†** | Zustand | 4.x | è½»é‡ã€ç®€å• |
| **å›¾ç‰‡å‹ç¼©** | browser-image-compression | 2.x | çº¯å‰ç«¯ã€å‹ç¼©æ•ˆæœå¥½ |
| **å›¾ç‰‡å¤„ç†** | Fabric.js | 5.x | åŠŸèƒ½å¼ºå¤§ã€æ˜“ç”¨ |
| **æ–‡ä»¶ä¸Šä¼ ** | react-dropzone | 14.x | æ‹–æ‹½ä¸Šä¼ ä½“éªŒå¥½ |
| **æ‰¹é‡ä¸‹è½½** | JSZip + FileSaver.js | latest | æ‰“åŒ… ZIP ä¸‹è½½ |
| **è·¯ç”±** | React Router | 6.x | SPA è·¯ç”±ç®¡ç† |
| **å›¾æ ‡** | Lucide React | latest | ç°ä»£ã€ç¾è§‚ |

---

## 2. é¡¹ç›®ç»“æ„

```
ImageKit/
â”œâ”€â”€ public/                  # é™æ€èµ„æº
â”‚   â”œâ”€â”€ favicon.ico
â”‚   â””â”€â”€ logo.png
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ assets/             # å›¾ç‰‡ã€å­—ä½“ç­‰èµ„æº
â”‚   â”œâ”€â”€ components/         # å…¬å…±ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ui/            # shadcn/ui ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Layout/        # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ Header.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Footer.tsx
â”‚   â”‚   â”‚   â””â”€â”€ Sidebar.tsx
â”‚   â”‚   â”œâ”€â”€ ImageUploader/ # å›¾ç‰‡ä¸Šä¼ ç»„ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ Dropzone.tsx
â”‚   â”‚   â”œâ”€â”€ ImagePreview/  # å›¾ç‰‡é¢„è§ˆç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ ImageCard.tsx
â”‚   â”‚   â”‚   â””â”€â”€ CompareView.tsx
â”‚   â”‚   â””â”€â”€ ToolPanel/     # å·¥å…·é¢æ¿ç»„ä»¶
â”‚   â”‚       â”œâ”€â”€ CompressTool.tsx
â”‚   â”‚       â”œâ”€â”€ ConvertTool.tsx
â”‚   â”‚       â”œâ”€â”€ ResizeTool.tsx
â”‚   â”‚       â”œâ”€â”€ CropTool.tsx
â”‚   â”‚       â””â”€â”€ RotateTool.tsx
â”‚   â”œâ”€â”€ pages/             # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Home.tsx       # é¦–é¡µ
â”‚   â”‚   â”œâ”€â”€ Compress.tsx   # å‹ç¼©é¡µ
â”‚   â”‚   â”œâ”€â”€ Convert.tsx    # è½¬æ¢é¡µ
â”‚   â”‚   â”œâ”€â”€ Resize.tsx     # è°ƒæ•´å¤§å°é¡µ
â”‚   â”‚   â”œâ”€â”€ Crop.tsx       # è£å‰ªé¡µ
â”‚   â”‚   â””â”€â”€ About.tsx      # å…³äºé¡µ
â”‚   â”œâ”€â”€ hooks/             # è‡ªå®šä¹‰ Hooks
â”‚   â”‚   â”œâ”€â”€ useImageProcessor.ts
â”‚   â”‚   â”œâ”€â”€ useImageStore.ts
â”‚   â”‚   â””â”€â”€ useDownload.ts
â”‚   â”œâ”€â”€ utils/             # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ imageCompressor.ts    # å›¾ç‰‡å‹ç¼©
â”‚   â”‚   â”œâ”€â”€ imageConverter.ts     # æ ¼å¼è½¬æ¢
â”‚   â”‚   â”œâ”€â”€ imageResizer.ts       # å°ºå¯¸è°ƒæ•´
â”‚   â”‚   â”œâ”€â”€ imageCropper.ts       # è£å‰ª
â”‚   â”‚   â”œâ”€â”€ imageRotator.ts       # æ—‹è½¬/ç¿»è½¬
â”‚   â”‚   â”œâ”€â”€ downloadHelper.ts     # ä¸‹è½½è¾…åŠ©
â”‚   â”‚   â””â”€â”€ fileValidator.ts      # æ–‡ä»¶éªŒè¯
â”‚   â”œâ”€â”€ store/             # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â””â”€â”€ imageStore.ts  # å›¾ç‰‡çŠ¶æ€
â”‚   â”œâ”€â”€ types/             # TypeScript ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ image.ts
â”‚   â”‚   â””â”€â”€ tool.ts
â”‚   â”œâ”€â”€ constants/         # å¸¸é‡å®šä¹‰
â”‚   â”‚   â””â”€â”€ config.ts
â”‚   â”œâ”€â”€ App.tsx           # æ ¹ç»„ä»¶
â”‚   â”œâ”€â”€ main.tsx          # å…¥å£æ–‡ä»¶
â”‚   â””â”€â”€ index.css         # å…¨å±€æ ·å¼
â”œâ”€â”€ docs/                 # æ–‡æ¡£
â”‚   â”œâ”€â”€ 01-äº§å“éœ€æ±‚æ–‡æ¡£PRD.md
â”‚   â”œâ”€â”€ 02-æŠ€æœ¯å¼€å‘æ–‡æ¡£.md
â”‚   â”œâ”€â”€ 03-å¼€å‘æ¡†æ¶è¯´æ˜.md
â”‚   â”œâ”€â”€ 04-å®ç°æµç¨‹.md
â”‚   â””â”€â”€ 05-é¡µé¢å¸ƒå±€è®¾è®¡éœ€æ±‚.md
â”œâ”€â”€ .gitignore
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ vite.config.ts
â”œâ”€â”€ tailwind.config.js
â”œâ”€â”€ postcss.config.js
â””â”€â”€ README.md
```

---

## 3. æ ¸å¿ƒæ¨¡å—è®¾è®¡

### 3.1 å›¾ç‰‡çŠ¶æ€ç®¡ç†ï¼ˆZustand Storeï¼‰

```typescript
// src/store/imageStore.ts

import { create } from 'zustand';

interface ProcessedImage {
  id: string;
  originalFile: File;
  originalUrl: string;
  processedUrl?: string;
  originalSize: number;
  processedSize?: number;
  compressionRatio?: number;
  status: 'pending' | 'processing' | 'completed' | 'error';
  error?: string;
}

interface ImageStore {
  images: ProcessedImage[];
  currentTool: 'compress' | 'convert' | 'resize' | 'crop' | 'rotate';
  
  // Actions
  addImages: (files: File[]) => void;
  removeImage: (id: string) => void;
  updateImage: (id: string, data: Partial<ProcessedImage>) => void;
  clearAll: () => void;
  setCurrentTool: (tool: string) => void;
}

export const useImageStore = create<ImageStore>((set) => ({
  images: [],
  currentTool: 'compress',
  
  addImages: (files) => set((state) => ({
    images: [
      ...state.images,
      ...files.map(file => ({
        id: crypto.randomUUID(),
        originalFile: file,
        originalUrl: URL.createObjectURL(file),
        originalSize: file.size,
        status: 'pending' as const,
      }))
    ]
  })),
  
  removeImage: (id) => set((state) => ({
    images: state.images.filter(img => img.id !== id)
  })),
  
  updateImage: (id, data) => set((state) => ({
    images: state.images.map(img => 
      img.id === id ? { ...img, ...data } : img
    )
  })),
  
  clearAll: () => set({ images: [] }),
  
  setCurrentTool: (tool) => set({ currentTool: tool as any }),
}));
```

---

### 3.2 å›¾ç‰‡å‹ç¼©æ¨¡å—ï¼ˆä¼˜åŒ–ç‰ˆï¼‰

#### 3.2.1 æ ¸å¿ƒåŠŸèƒ½

**ç‰¹æ€§**ï¼š
- âœ… æ™ºèƒ½åˆ†çº§å‹ç¼©ç­–ç•¥ï¼ˆæ ¹æ®æ–‡ä»¶å¤§å°è‡ªåŠ¨è°ƒæ•´ï¼‰
- âœ… äºŒæ¬¡å‹ç¼©æœºåˆ¶ï¼ˆå‹ç¼©æ•ˆæœä¸ä½³æ—¶è‡ªåŠ¨ä¼˜åŒ–ï¼‰
- âœ… è¾“å‡ºæ ¼å¼è½¬æ¢ï¼ˆJPG/PNG/WebP/åŸæ ¼å¼ï¼‰
- âœ… é‡æ–°å‹ç¼©æ”¯æŒï¼ˆå‚æ•°ä¿®æ”¹åå¯é‡æ–°å¤„ç†ï¼‰
- âœ… å¿«é€Ÿé¢„è®¾ï¼ˆé«˜è´¨é‡/æ ‡å‡†/é«˜å‹ç¼©ï¼‰
- âœ… åŒè§†å›¾æ¨¡å¼ï¼ˆç½‘æ ¼/åˆ—è¡¨ï¼‰
- âœ… å•å¼ ä¸‹è½½ + æ‰¹é‡ä¸‹è½½
- âœ… å®æ—¶å‹ç¼©ç‡æ˜¾ç¤º

```typescript
// src/utils/imageCompressor.ts

import imageCompression from 'browser-image-compression';

export interface CompressOptions {
  quality: number; // 0-100
  maxSizeMB?: number;
  maxWidthOrHeight?: number;
  useWebWorker?: boolean;
}

/**
 * é«˜çº§å‹ç¼©å›¾ç‰‡ - å¤šçº§å‹ç¼©ç­–ç•¥
 * @param file åŸå§‹å›¾ç‰‡æ–‡ä»¶
 * @param options å‹ç¼©é€‰é¡¹
 * @param outputFormat è¾“å‡ºæ ¼å¼ï¼ˆå¯é€‰ï¼‰
 * @returns å‹ç¼©åçš„ Blob å’Œå…ƒæ•°æ®
 */
export async function compressImage(
  file: File,
  options: CompressOptions,
  outputFormat?: 'original' | 'jpeg' | 'png' | 'webp'
): Promise<{
  blob: Blob;
  size: number;
  compressionRatio: number;
  url: string;
}> {
  try {
    const quality = options.quality / 100;
    const fileSizeMB = file.size / 1024 / 1024;
    
    // ç¡®å®šæœ€ç»ˆè¾“å‡ºçš„æ–‡ä»¶æ ¼å¼
    const targetFileType = 
      outputFormat === 'jpeg' ? 'image/jpeg' :
      outputFormat === 'png' ? 'image/png' :
      outputFormat === 'webp' ? 'image/webp' :
      file.type; // ä½¿ç”¨åŸæ ¼å¼
    
    let compressOptions: any;
    
    // æ™ºèƒ½åˆ†çº§å‹ç¼©ç­–ç•¥
    if (fileSizeMB > 5) {
      // å¤§æ–‡ä»¶ï¼šæ¿€è¿›å‹ç¼©
      compressOptions = {
        maxSizeMB: 0.5,              // é™åˆ¶æœ€å¤§500KB
        maxWidthOrHeight: 1920,       // é™åˆ¶æœ€å¤§åˆ†è¾¨ç‡
        useWebWorker: true,
        initialQuality: quality * 0.85, // é™ä½åˆå§‹è´¨é‡
        alwaysKeepResolution: false,
        fileType: targetFileType,
      };
    } else if (fileSizeMB > 2) {
      // ä¸­ç­‰æ–‡ä»¶ï¼šé€‚ä¸­å‹ç¼©
      compressOptions = {
        maxSizeMB: 0.8,
        maxWidthOrHeight: 2048,
        useWebWorker: true,
        initialQuality: quality * 0.9,
        alwaysKeepResolution: false,
        fileType: targetFileType,
      };
    } else {
      // å°æ–‡ä»¶ï¼šæ ‡å‡†å‹ç¼©
      compressOptions = {
        maxSizeMB: 1,
        maxWidthOrHeight: 2560,
        useWebWorker: true,
        initialQuality: quality,
        alwaysKeepResolution: false,
        fileType: targetFileType,
      };
    }

    // ç¬¬ä¸€æ¬¡å‹ç¼©
    let compressedBlob = await imageCompression(file, compressOptions);
    
    // äºŒæ¬¡å‹ç¼©æœºåˆ¶ï¼šå¦‚æœå‹ç¼©æ•ˆæœä¸ç†æƒ³ï¼Œè¿›è¡ŒäºŒæ¬¡å‹ç¼©
    const firstCompressionRatio = ((file.size - compressedBlob.size) / file.size) * 100;
    
    if (firstCompressionRatio < 30 && compressedBlob.size > 500 * 1024) {
      const secondCompressOptions = {
        ...compressOptions,
        maxSizeMB: compressOptions.maxSizeMB * 0.7,
        initialQuality: quality * 0.75,
      };
      
      const secondFile = new File([compressedBlob], file.name, { type: file.type });
      compressedBlob = await imageCompression(secondFile, secondCompressOptions);
    }
    
    const finalCompressionRatio = ((file.size - compressedBlob.size) / file.size) * 100;
    
    return {
      blob: compressedBlob,
      size: compressedBlob.size,
      compressionRatio: finalCompressionRatio,
      url: URL.createObjectURL(compressedBlob),
    };
  } catch (error) {
    throw new Error(`å‹ç¼©å¤±è´¥: ${error instanceof Error ? error.message : 'æœªçŸ¥é”™è¯¯'}`);
  }
}

/**
 * æ‰¹é‡å‹ç¼©å›¾ç‰‡
 */
export async function batchCompressImages(
  files: File[],
  options: CompressOptions,
  onProgress?: (current: number, total: number) => void
): Promise<Array<{
  file: File;
  result: Awaited<ReturnType<typeof compressImage>>;
}>> {
  const results = [];
  
  for (let i = 0; i < files.length; i++) {
    const result = await compressImage(files[i], options);
    results.push({ file: files[i], result });
    onProgress?.(i + 1, files.length);
  }
  
  return results;
}
```

#### 3.2.2 å‹ç¼©ç­–ç•¥è¯´æ˜

**æ™ºèƒ½åˆ†çº§å‹ç¼©**ï¼š
```
å¤§æ–‡ä»¶ (>5MB):
  â”œâ”€ æœ€å¤§è¾“å‡º: 500KB
  â”œâ”€ æœ€å¤§åˆ†è¾¨ç‡: 1920px
  â”œâ”€ è´¨é‡ç³»æ•°: 0.85x
  â””â”€ ç”¨é€”: ç½‘é¡µèƒŒæ™¯ã€å¤§å›¾ä¼˜åŒ–

ä¸­ç­‰æ–‡ä»¶ (2-5MB):
  â”œâ”€ æœ€å¤§è¾“å‡º: 800KB
  â”œâ”€ æœ€å¤§åˆ†è¾¨ç‡: 2048px
  â”œâ”€ è´¨é‡ç³»æ•°: 0.9x
  â””â”€ ç”¨é€”: å¸¸è§„å›¾ç‰‡å‹ç¼©

å°æ–‡ä»¶ (<2MB):
  â”œâ”€ æœ€å¤§è¾“å‡º: 1MB
  â”œâ”€ æœ€å¤§åˆ†è¾¨ç‡: 2560px
  â”œâ”€ è´¨é‡ç³»æ•°: 1.0x
  â””â”€ ç”¨é€”: ä¿æŒé«˜è´¨é‡
```

**äºŒæ¬¡å‹ç¼©æœºåˆ¶**ï¼š
- è§¦å‘æ¡ä»¶ï¼šé¦–æ¬¡å‹ç¼©ç‡ < 30% ä¸”æ–‡ä»¶ > 500KB
- äºŒæ¬¡å‹ç¼©ï¼šè¿›ä¸€æ­¥é™ä½è´¨é‡åˆ° 75%
- ç›®æ ‡ï¼šç¡®ä¿ç†æƒ³çš„å‹ç¼©æ•ˆæœ

#### 3.2.3 UI ç»„ä»¶è®¾è®¡

**å·¥å…·é¢æ¿**ï¼š
```typescript
// src/pages/Compress.tsx

// å¿«é€Ÿé¢„è®¾
const presets = [
  { label: 'é«˜è´¨é‡', quality: 90, desc: 'è½»åº¦å‹ç¼©ï¼Œä¿æŒç”»è´¨' },
  { label: 'æ ‡å‡†', quality: 80, desc: 'å¹³è¡¡è´¨é‡å’Œå¤§å°' },
  { label: 'é«˜å‹ç¼©', quality: 60, desc: 'å¤§å¹…ç¼©å°ï¼Œé€‚åˆç½‘é¡µ' },
];

// è¾“å‡ºæ ¼å¼é€‰é¡¹
const formatOptions = [
  { value: 'original', label: 'åŸæ ¼å¼' },
  { value: 'jpeg', label: 'JPG' },
  { value: 'png', label: 'PNG' },
  { value: 'webp', label: 'WebP' },
];

// è§†å›¾æ¨¡å¼
const [viewMode, setViewMode] = useState<'grid' | 'list'>('grid');
```

**åŒè§†å›¾æ¨¡å¼**ï¼š
1. **ç½‘æ ¼è§†å›¾** - å¡ç‰‡å¸ƒå±€ï¼Œé€‚åˆé¢„è§ˆå›¾ç‰‡
2. **åˆ—è¡¨è§†å›¾** - ç´§å‡‘å¸ƒå±€ï¼Œé€‚åˆæ‰¹é‡å¤„ç†

**åŠŸèƒ½æŒ‰é’®**ï¼š
- **å‹ç¼©æŒ‰é’®** - æ™ºèƒ½æ˜¾ç¤º"å‹ç¼©"æˆ–"é‡æ–°å‹ç¼©"
- **å•å¼ ä¸‹è½½** - æ¯å¼ å›¾ç‰‡ç‹¬ç«‹ä¸‹è½½æŒ‰é’®
- **æ‰¹é‡ä¸‹è½½** - æ‰“åŒ…æˆZIPä¸‹è½½
- **æ¸…ç©ºåˆ—è¡¨** - ä¸€é”®æ¸…é™¤æ‰€æœ‰å›¾ç‰‡

#### 3.2.4 å…³é”®ç‰¹æ€§å®ç°

**1. å‚æ•°ä¿®æ”¹åé‡æ–°å‹ç¼©**ï¼š
```typescript
const handleCompressAll = async () => {
  setProcessing(true);
  try {
    // å‹ç¼©æ‰€æœ‰å›¾ç‰‡ï¼ŒåŒ…æ‹¬å·²å®Œæˆçš„
    for (const image of images) {
      await handleCompressSingle(image.id);
    }
  } finally {
    setProcessing(false);
  }
};
```

**2. è¾“å‡ºæ ¼å¼ä¸€è‡´æ€§**ï¼š
```typescript
// å‹ç¼©æ—¶ç›´æ¥ä½¿ç”¨ç›®æ ‡æ ¼å¼
const result = await compressImage(
  image.originalFile, 
  { quality },
  outputFormat  // ç¡®ä¿æ˜¾ç¤ºçš„å¤§å°å°±æ˜¯æœ€ç»ˆå¤§å°
);
```

**3. æ™ºèƒ½æç¤º**ï¼š
```typescript
// æŒ‰é’®æ–‡æ¡ˆ
{processing 
  ? 'å‹ç¼©ä¸­...' 
  : hasCompleted 
    ? `é‡æ–°å‹ç¼© ${images.length}å¼ ` 
    : `å‹ç¼© ${images.length}å¼ `
}

// å‚æ•°æç¤º
{hasCompleted 
  ? 'ğŸ’¡ ä¿®æ”¹å‚æ•°åç‚¹å‡»"é‡æ–°å‹ç¼©"ç”Ÿæ•ˆ' 
  : 'æ¨è80%ï¼ˆæ¥è¿‘TinyPNGæ•ˆæœï¼‰'
}
```

#### 3.2.5 æ€§èƒ½ä¼˜åŒ–

**UI ä¼˜åŒ–**ï¼š
- éšè—æ»šåŠ¨æ¡ä½†ä¿æŒæ»šåŠ¨åŠŸèƒ½ï¼ˆå…¨å±€CSSï¼‰
- å“åº”å¼è®¾è®¡ï¼ˆç§»åŠ¨ç«¯é€‚é…ï¼‰
- è§¦æ‘¸å‹å¥½çš„æŒ‰é’®å¸ƒå±€

**å‹ç¼©ä¼˜åŒ–**ï¼š
- Web Worker é¿å…é˜»å¡ä¸»çº¿ç¨‹
- åˆ†è¾¨ç‡æ™ºèƒ½é™åˆ¶
- åŠæ—¶é‡Šæ”¾å†…å­˜ï¼ˆURL.revokeObjectURLï¼‰

**ç”¨æˆ·ä½“éªŒ**ï¼š
- å®æ—¶æ˜¾ç¤ºå‹ç¼©è¿›åº¦
- å‹ç¼©ç‡å¯è§†åŒ–ï¼ˆå¾½ç« æ˜¾ç¤ºï¼‰
- æ“ä½œæŒ‰é’®æ™ºèƒ½æ˜¾éš

---

### 3.3 æ ¼å¼è½¬æ¢æ¨¡å—

#### 3.3.1 æ ¸å¿ƒåŠŸèƒ½

**ç‰¹æ€§**ï¼š
- âœ… æ”¯æŒ JPGã€PNGã€WebP äº’è½¬
- âœ… è´¨é‡å¯è°ƒèŠ‚ï¼ˆJPG/WebPï¼‰
- âœ… æ‰¹é‡è½¬æ¢æ”¯æŒ
- âœ… ä¿æŒåŸå§‹åˆ†è¾¨ç‡
- âœ… é‡æ–°è½¬æ¢æ”¯æŒ
- âœ… ç½‘æ ¼/åˆ—è¡¨åŒè§†å›¾
- âœ… å•å¼ ä¸‹è½½ + æ‰¹é‡ä¸‹è½½ZIP

```typescript
// src/utils/imageConverter.ts

export type ImageFormat = 'jpeg' | 'png' | 'webp';

export interface ConvertOptions {
  format: ImageFormat;
  quality?: number; // 0-1 (ä»… jpeg/webp)
}

/**
 * è½¬æ¢å›¾ç‰‡æ ¼å¼
 */
export async function convertImage(
  file: File,
  options: ConvertOptions
): Promise<{
  blob: Blob;
  size: number;
  url: string;
}> {
  return new Promise((resolve, reject) => {
    const img = new Image();
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');

    img.onload = () => {
      canvas.width = img.width;
      canvas.height = img.height;
      
      // é«˜è´¨é‡ç»˜åˆ¶
      if (ctx) {
        ctx.imageSmoothingEnabled = true;
        ctx.imageSmoothingQuality = 'high';
        ctx.drawImage(img, 0, 0);
      }
      
      const mimeType = getMimeType(options.format);
      const quality = options.quality || 0.92;
      
      canvas.toBlob(
        (blob) => {
          if (!blob) {
            reject(new Error('è½¬æ¢å¤±è´¥'));
            return;
          }
          
          resolve({
            blob,
            size: blob.size,
            url: URL.createObjectURL(blob),
          });
        },
        mimeType,
        quality
      );
    };

    img.onerror = () => reject(new Error('å›¾ç‰‡åŠ è½½å¤±è´¥'));
    img.src = URL.createObjectURL(file);
  });
}

function getMimeType(format: ImageFormat): string {
  const mimeTypes = {
    jpeg: 'image/jpeg',
    png: 'image/png',
    webp: 'image/webp',
  };
  return mimeTypes[format];
}
```

#### 3.3.2 æ ¼å¼é€‰é¡¹

**æ”¯æŒçš„æ ¼å¼**ï¼š

| æ ¼å¼ | MIMEç±»å‹ | è´¨é‡è°ƒèŠ‚ | é€æ˜åº¦ | æ–‡ä»¶å¤§å° | ç”¨é€” |
|------|---------|---------|--------|---------|------|
| **JPG** | image/jpeg | âœ… æ”¯æŒ | âŒ ä¸æ”¯æŒ | å° | ç…§ç‰‡ã€ç½‘é¡µå›¾ç‰‡ |
| **PNG** | image/png | âŒ æ— æŸ | âœ… æ”¯æŒ | å¤§ | Logoã€å›¾æ ‡ã€éœ€è¦é€æ˜ |
| **WebP** | image/webp | âœ… æ”¯æŒ | âœ… æ”¯æŒ | æœ€å° | ç°ä»£ç½‘é¡µã€æ€§èƒ½ä¼˜å…ˆ |

#### 3.3.3 UI ç»„ä»¶è®¾è®¡

**è½¬æ¢è®¾ç½®é¢æ¿**ï¼š
```typescript
// æ ¼å¼é€‰é¡¹
const formatOptions = [
  { value: 'jpeg', label: 'JPG', desc: 'é€šç”¨æ ¼å¼ï¼Œå…¼å®¹æ€§å¥½' },
  { value: 'png', label: 'PNG', desc: 'æ— æŸæ ¼å¼ï¼Œæ”¯æŒé€æ˜' },
  { value: 'webp', label: 'WebP', desc: 'ç°ä»£æ ¼å¼ï¼Œä½“ç§¯å°' },
];

// è´¨é‡è°ƒèŠ‚
<Slider
  value={[quality]}
  onValueChange={(val) => setQuality(val[0])}
  min={1}
  max={100}
  step={1}
/>
```

**æ™ºèƒ½æç¤º**ï¼š
- PNG æ ¼å¼æç¤ºï¼š`ğŸ’¡ PNG ä¸ºæ— æŸæ ¼å¼ï¼Œä¸æ”¯æŒè´¨é‡è°ƒèŠ‚ï¼Œä¼šä¿ç•™åŸå§‹è´¨é‡å’Œé€æ˜åº¦`
- å‚æ•°ä¿®æ”¹æç¤ºï¼š`ğŸ’¡ ä¿®æ”¹å‚æ•°åç‚¹å‡»"é‡æ–°è½¬æ¢"ç”Ÿæ•ˆ`
- è´¨é‡æ¨èï¼š`æ¨è92%ï¼ˆé«˜è´¨é‡è¾“å‡ºï¼‰`

---

### 3.4 å°ºå¯¸è°ƒæ•´æ¨¡å—

#### 3.4.1 æ ¸å¿ƒåŠŸèƒ½

**ç‰¹æ€§**ï¼š
- âœ… æŒ‡å®šå°ºå¯¸è°ƒæ•´ï¼ˆåƒç´ ï¼‰
- âœ… ç¼©æ”¾æ¯”ä¾‹è°ƒæ•´ï¼ˆç™¾åˆ†æ¯”ï¼‰
- âœ… ä¿æŒå®½é«˜æ¯”é€‰é¡¹
- âœ… å¿«é€Ÿé¢„è®¾å°ºå¯¸
- âœ… å¿«é€Ÿé¢„è®¾æ¯”ä¾‹
- âœ… æ‰¹é‡è°ƒæ•´æ”¯æŒ
- âœ… é‡æ–°è°ƒæ•´æ”¯æŒ
- âœ… ç½‘æ ¼/åˆ—è¡¨åŒè§†å›¾

```typescript
// src/utils/imageResizer.ts

export interface ResizeOptions {
  width?: number;
  height?: number;
  scale?: number; // ç™¾åˆ†æ¯”
  keepAspectRatio?: boolean;
}

/**
 * è°ƒæ•´å›¾ç‰‡å°ºå¯¸
 */
export async function resizeImage(
  file: File,
  options: ResizeOptions
): Promise<{
  blob: Blob;
  width: number;
  height: number;
  url: string;
}> {
  return new Promise((resolve, reject) => {
    const img = new Image();
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');

    img.onload = () => {
      let { width, height } = calculateDimensions(
        img.width,
        img.height,
        options
      );
      
      canvas.width = width;
      canvas.height = height;
      
      // ä½¿ç”¨é«˜è´¨é‡ç¼©æ”¾
      ctx.imageSmoothingEnabled = true;
      ctx.imageSmoothingQuality = 'high';
      ctx?.drawImage(img, 0, 0, width, height);
      
      canvas.toBlob(
        (blob) => {
          if (!blob) {
            reject(new Error('è°ƒæ•´å¤±è´¥'));
            return;
          }
          
          resolve({
            blob,
            width,
            height,
            url: URL.createObjectURL(blob),
          });
        },
        file.type,
        0.92
      );
    };

    img.onerror = () => reject(new Error('å›¾ç‰‡åŠ è½½å¤±è´¥'));
    img.src = URL.createObjectURL(file);
  });
}

function calculateDimensions(
  originalWidth: number,
  originalHeight: number,
  options: ResizeOptions
): { width: number; height: number } {
  if (options.scale) {
    return {
      width: Math.round(originalWidth * options.scale / 100),
      height: Math.round(originalHeight * options.scale / 100),
    };
  }
  
  if (options.width && options.height && !options.keepAspectRatio) {
    return { width: options.width, height: options.height };
  }
  
  if (options.width && options.keepAspectRatio) {
    const ratio = options.width / originalWidth;
    return {
      width: options.width,
      height: Math.round(originalHeight * ratio),
    };
  }
  
  if (options.height && options.keepAspectRatio) {
    const ratio = options.height / originalHeight;
    return {
      width: Math.round(originalWidth * ratio),
      height: options.height,
    };
  }
  
  return { width: originalWidth, height: originalHeight };
}
```

#### 3.4.2 è°ƒæ•´æ¨¡å¼

**ä¸¤ç§æ¨¡å¼**ï¼š

1. **æŒ‡å®šå°ºå¯¸æ¨¡å¼**
   - è¾“å…¥å®½åº¦å’Œé«˜åº¦ï¼ˆåƒç´ ï¼‰
   - å¯é€‰ä¿æŒå®½é«˜æ¯”
   - å¿«é€Ÿé¢„è®¾ï¼š1920Ã—1080ã€1280Ã—720ã€800Ã—600ã€640Ã—480

2. **ç¼©æ”¾æ¯”ä¾‹æ¨¡å¼**
   - è¾“å…¥ç¼©æ”¾ç™¾åˆ†æ¯”
   - è‡ªåŠ¨ä¿æŒå®½é«˜æ¯”
   - å¿«é€Ÿé¢„è®¾ï¼š200%ã€150%ã€100%ã€75%ã€50%ã€25%

#### 3.4.3 UI ç»„ä»¶è®¾è®¡

**è°ƒæ•´è®¾ç½®é¢æ¿**ï¼š
```typescript
// è°ƒæ•´æ¨¡å¼é€‰æ‹©
const [resizeMode, setResizeMode] = useState<'dimension' | 'scale'>('dimension');

// é¢„è®¾å°ºå¯¸
const presetSizes = [
  { label: '1920Ã—1080', width: 1920, height: 1080 },
  { label: '1280Ã—720', width: 1280, height: 720 },
  { label: '800Ã—600', width: 800, height: 600 },
  { label: '640Ã—480', width: 640, height: 480 },
];

// é¢„è®¾æ¯”ä¾‹
const presetScales = [
  { label: '200%', value: 200 },
  { label: '150%', value: 150 },
  { label: '100%', value: 100 },
  { label: '75%', value: 75 },
  { label: '50%', value: 50 },
  { label: '25%', value: 25 },
];
```

**ä¿æŒå®½é«˜æ¯”å¼€å…³**ï¼š
```typescript
<div className="flex items-center justify-between">
  <Label htmlFor="keep-ratio">ä¿æŒå®½é«˜æ¯”</Label>
  <Switch
    id="keep-ratio"
    checked={keepAspectRatio}
    onCheckedChange={setKeepAspectRatio}
  />
</div>
```

---

### 3.5 è£å‰ªæ¨¡å—ï¼ˆä½¿ç”¨ react-image-cropï¼‰

#### 3.5.1 æ ¸å¿ƒåŠŸèƒ½

**ç‰¹æ€§**ï¼š
- âœ… å¯è§†åŒ–è£å‰ªæ¡†
- âœ… æ‹–æ‹½å››ä¸ªè§’è°ƒæ•´å¤§å°
- âœ… æ¯”ä¾‹é¢„è®¾ï¼ˆè‡ªç”±/1:1/16:9/4:3/3:2/9:16ï¼‰
- âœ… æ—‹è½¬æ”¯æŒï¼ˆ0-360Â°ï¼‰
- âœ… ç¼©æ”¾æ”¯æŒï¼ˆ0.5x-3xï¼‰
- âœ… æ ¼å¼è½¬æ¢ï¼ˆåŸæ ¼å¼/JPG/PNG/WebPï¼‰
- âœ… è´¨é‡è°ƒèŠ‚ï¼ˆJPG/WebPï¼‰
- âœ… æ‹–æ‹½ä¸Šä¼ 
- âœ… è£å‰ªèƒŒæ™¯å›¾æ¡ˆ

#### 3.5.2 è£å‰ªæ¨¡å—

```typescript
// src/pages/Crop.tsx - ä½¿ç”¨ react-image-crop

import ReactCrop, { type Crop, centerCrop, makeAspectCrop } from 'react-image-crop';
import 'react-image-crop/dist/ReactCrop.css';

// è£å‰ªæ¯”ä¾‹é¢„è®¾
const ratioPresets = [
  { label: 'è‡ªç”±', value: 'free', aspect: undefined, desc: 'ä»»æ„æ¯”ä¾‹' },
  { label: '1:1', value: '1:1', aspect: 1, desc: 'æ­£æ–¹å½¢' },
  { label: '16:9', value: '16:9', aspect: 16/9, desc: 'å®½å±' },
  { label: '4:3', value: '4:3', aspect: 4/3, desc: 'æ ‡å‡†' },
  { label: '3:2', value: '3:2', aspect: 3/2, desc: 'ç…§ç‰‡' },
  { label: '9:16', value: '9:16', aspect: 9/16, desc: 'ç«–å±' },
];

// ç”Ÿæˆè£å‰ªåçš„å›¾ç‰‡ï¼ˆæ”¯æŒæ—‹è½¬å’Œç¼©æ”¾ï¼‰
const generateCroppedImage = async () => {
  if (!completedCrop || !imgRef.current) return;

  const image = imgRef.current;
  const canvas = document.createElement('canvas');
  const ctx = canvas.getContext('2d');

  if (!ctx) return;

  const scaleX = image.naturalWidth / image.width;
  const scaleY = image.naturalHeight / image.height;

  // å¦‚æœæœ‰æ—‹è½¬ï¼Œéœ€è¦å…ˆæ—‹è½¬æ•´ä¸ªå›¾ç‰‡
  if (rotation !== 0) {
    const rotRad = (rotation * Math.PI) / 180;
    
    // è®¡ç®—æ—‹è½¬åçš„ç”»å¸ƒå¤§å°
    const rotatedWidth = Math.abs(image.naturalWidth * Math.cos(rotRad)) + 
                         Math.abs(image.naturalHeight * Math.sin(rotRad));
    const rotatedHeight = Math.abs(image.naturalWidth * Math.sin(rotRad)) + 
                          Math.abs(image.naturalHeight * Math.cos(rotRad));
    
    // åˆ›å»ºä¸´æ—¶ç”»å¸ƒç”¨äºæ—‹è½¬
    const tempCanvas = document.createElement('canvas');
    const tempCtx = tempCanvas.getContext('2d');
    if (!tempCtx) return;
    
    tempCanvas.width = rotatedWidth;
    tempCanvas.height = rotatedHeight;
    
    // å°†åŸç‚¹ç§»åˆ°ç”»å¸ƒä¸­å¿ƒï¼Œæ—‹è½¬ï¼Œç„¶åç»˜åˆ¶
    tempCtx.translate(rotatedWidth / 2, rotatedHeight / 2);
    tempCtx.rotate(rotRad);
    tempCtx.drawImage(
      image,
      -image.naturalWidth / 2,
      -image.naturalHeight / 2
    );
    
    // ä»æ—‹è½¬åçš„å›¾ç‰‡ä¸­è£å‰ª
    canvas.width = completedCrop.width * scaleX;
    canvas.height = completedCrop.height * scaleY;
    
    ctx.imageSmoothingQuality = 'high';
    ctx.drawImage(
      tempCanvas,
      completedCrop.x * scaleX,
      completedCrop.y * scaleY,
      completedCrop.width * scaleX,
      completedCrop.height * scaleY,
      0,
      0,
      canvas.width,
      canvas.height
    );
  } else {
    // æ²¡æœ‰æ—‹è½¬ï¼Œç›´æ¥è£å‰ª
    canvas.width = completedCrop.width * scaleX;
    canvas.height = completedCrop.height * scaleY;

    ctx.imageSmoothingQuality = 'high';
    ctx.drawImage(
      image,
      completedCrop.x * scaleX,
      completedCrop.y * scaleY,
      completedCrop.width * scaleX,
      completedCrop.height * scaleY,
      0,
      0,
      canvas.width,
      canvas.height
    );
  }

  return canvas.toDataURL('image/png');
};
```

#### 3.5.3 è£å‰ªç‰¹æ€§

**æ—‹è½¬å’Œç¼©æ”¾**ï¼š
```typescript
// æ—‹è½¬çŠ¶æ€
const [rotation, setRotation] = useState(0); // 0-360Â°

// ç¼©æ”¾çŠ¶æ€
const [scale, setScale] = useState(1); // 0.5x-3x

// CSS å®æ—¶é¢„è§ˆ
<img
  style={{
    transform: `scale(${scale}) rotate(${rotation}deg)`,
    transition: 'transform 0.2s ease-in-out'
  }}
/>
```

**è£å‰ªèƒŒæ™¯**ï¼š
```typescript
// ä½¿ç”¨å¹³é“ºèƒŒæ™¯å›¾æ¡ˆ
import cropBgImage from '@/assets/cropBg.png';

<Card 
  style={{
    backgroundImage: `url(${cropBgImage})`,
    backgroundRepeat: 'repeat'
  }}
>
  <ReactCrop ...>
    <img src={imageSrc} />
  </ReactCrop>
</Card>
```

---

### 3.6 æ°´å°æ¨¡å—

#### 3.6.1 æ ¸å¿ƒåŠŸèƒ½

**ç‰¹æ€§**ï¼š
- âœ… æ–‡å­—æ°´å°æ”¯æŒ
- âœ… å›¾ç‰‡æ°´å°æ”¯æŒ
- âœ… 5ç§ä½ç½®é€‰æ‹©
- âœ… é€æ˜åº¦è°ƒèŠ‚
- âœ… æ–‡å­—ï¼šå­—å·ã€é¢œè‰²å¯è°ƒ
- âœ… å›¾ç‰‡ï¼šå¤§å°å¯è°ƒ
- âœ… åç§»é‡å¾®è°ƒ
- âœ… æ‰¹é‡æ·»åŠ æ°´å°
- âœ… é‡æ–°æ·»åŠ æ”¯æŒ

```typescript
// src/utils/watermarkProcessor.ts

interface TextWatermarkOptions {
  type: 'text';
  text: string;
  fontSize: number;
  fontColor: string;
  position: 'top-left' | 'top-right' | 'bottom-left' | 'bottom-right' | 'center';
  opacity: number;
  offsetX: number;
  offsetY: number;
}

interface ImageWatermarkOptions {
  type: 'image';
  watermarkImage: string;
  position: 'top-left' | 'top-right' | 'bottom-left' | 'bottom-right' | 'center';
  opacity: number;
  scale: number;
  offsetX: number;
  offsetY: number;
}

/**
 * æ·»åŠ æ°´å°åˆ°å›¾ç‰‡
 */
export async function addWatermark(
  file: File,
  options: TextWatermarkOptions | ImageWatermarkOptions
): Promise<{ url: string; size: number }> {
  return new Promise((resolve, reject) => {
    const img = new Image();
    const reader = new FileReader();

    reader.onload = (e) => {
      img.src = e.target?.result as string;
    };

    img.onload = async () => {
      try {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');

        if (!ctx) {
          throw new Error('æ— æ³•åˆ›å»º Canvas ä¸Šä¸‹æ–‡');
        }

        // è®¾ç½®ç”»å¸ƒå¤§å°
        canvas.width = img.width;
        canvas.height = img.height;

        // ç»˜åˆ¶åŸå›¾
        ctx.drawImage(img, 0, 0);

        // ä¿å­˜å½“å‰çŠ¶æ€
        ctx.save();
        
        // è®¾ç½®é€æ˜åº¦
        ctx.globalAlpha = options.opacity;

        if (options.type === 'text') {
          // æ·»åŠ æ–‡å­—æ°´å°
          await addTextWatermark(ctx, canvas, options);
        } else {
          // æ·»åŠ å›¾ç‰‡æ°´å°
          await addImageWatermark(ctx, canvas, options);
        }

        // æ¢å¤çŠ¶æ€
        ctx.restore();

        // è½¬æ¢ä¸º Blob
        canvas.toBlob((blob) => {
          if (!blob) {
            reject(new Error('è½¬æ¢å¤±è´¥'));
            return;
          }

          const url = URL.createObjectURL(blob);
          resolve({
            url,
            size: blob.size,
          });
        }, file.type || 'image/png');
      } catch (error) {
        reject(error);
      }
    };

    img.onerror = () => {
      reject(new Error('å›¾ç‰‡åŠ è½½å¤±è´¥'));
    };

    reader.readAsDataURL(file);
  });
}
```

#### 3.6.2 æ°´å°ç±»å‹

**æ–‡å­—æ°´å°**ï¼š
```typescript
// é»˜è®¤å‚æ•°
const [watermarkText, setWatermarkText] = useState('æ°´å°æ–‡å­—');
const [fontSize, setFontSize] = useState(48); // 12-120px
const [fontColor, setFontColor] = useState('#FFFFFF');
const [opacity, setOpacity] = useState(80); // 10-100%

// æ–‡å­—ç»˜åˆ¶
ctx.font = `${fontSize}px Arial, sans-serif`;
ctx.fillStyle = fontColor;
ctx.fillText(text, x, y);
```

**å›¾ç‰‡æ°´å°**ï¼š
```typescript
// é»˜è®¤å‚æ•°
const [watermarkImage, setWatermarkImage] = useState<string | null>(null);
const [watermarkScale, setWatermarkScale] = useState(30); // 10-100%
const [opacity, setOpacity] = useState(80);

// å›¾ç‰‡ç»˜åˆ¶
const watermarkWidth = watermark.width * scale;
const watermarkHeight = watermark.height * scale;
ctx.drawImage(watermark, x, y, watermarkWidth, watermarkHeight);
```

#### 3.6.3 ä½ç½®è®¡ç®—

**5ç§ä½ç½®**ï¼š
```typescript
function calculatePosition(
  canvasWidth: number,
  canvasHeight: number,
  watermarkWidth: number,
  watermarkHeight: number,
  position: string,
  offsetX: number,
  offsetY: number
): { x: number; y: number } {
  switch (position) {
    case 'top-left':
      return { x: offsetX, y: offsetY };
    case 'top-right':
      return { x: canvasWidth - watermarkWidth - offsetX, y: offsetY };
    case 'bottom-left':
      return { x: offsetX, y: canvasHeight - watermarkHeight - offsetY };
    case 'bottom-right':
      return { x: canvasWidth - watermarkWidth - offsetX, y: canvasHeight - watermarkHeight - offsetY };
    case 'center':
      return { x: (canvasWidth - watermarkWidth) / 2 + offsetX, y: (canvasHeight - watermarkHeight) / 2 + offsetY };
  }
}
```

---

### 3.7 æ‰¹é‡ä¸‹è½½æ¨¡å—

```typescript
// src/utils/downloadHelper.ts

import JSZip from 'jszip';
import { saveAs } from 'file-saver';

/**
 * ä¸‹è½½å•ä¸ªæ–‡ä»¶
 */
export function downloadFile(blob: Blob, filename: string): void {
  saveAs(blob, filename);
}

/**
 * æ‰¹é‡ä¸‹è½½ï¼ˆæ‰“åŒ…æˆ ZIPï¼‰
 */
export async function downloadAsZip(
  files: Array<{ blob: Blob; filename: string }>,
  zipName: string = 'images.zip'
): Promise<void> {
  const zip = new JSZip();
  
  files.forEach(({ blob, filename }) => {
    zip.file(filename, blob);
  });
  
  const zipBlob = await zip.generateAsync({ type: 'blob' });
  saveAs(zipBlob, zipName);
}
```

---

## 4. æ•°æ®æµè®¾è®¡

### 4.1 å›¾ç‰‡å¤„ç†æµç¨‹

```
ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡
    â†“
æ–‡ä»¶éªŒè¯ï¼ˆå¤§å°ã€æ ¼å¼ï¼‰
    â†“
æ·»åŠ åˆ° Storeï¼ˆçŠ¶æ€ï¼špendingï¼‰
    â†“
ç”¨æˆ·é€‰æ‹©å·¥å…· & è°ƒæ•´å‚æ•°
    â†“
ç‚¹å‡»"å¤„ç†"æŒ‰é’®
    â†“
æ›´æ–°çŠ¶æ€ï¼šprocessing
    â†“
è°ƒç”¨å¤„ç†å‡½æ•°ï¼ˆcompress/convert/resizeç­‰ï¼‰
    â†“
å¤„ç†å®Œæˆ
    â†“
æ›´æ–°çŠ¶æ€ï¼šcompleted
    â†“
æ˜¾ç¤ºå¤„ç†åé¢„è§ˆ
    â†“
ç”¨æˆ·ä¸‹è½½ï¼ˆå•ä¸ª/æ‰¹é‡ï¼‰
```

### 4.2 çŠ¶æ€æµè½¬å›¾

```
pending â”€â”€å¤„ç†å¼€å§‹â”€â”€> processing â”€â”€æˆåŠŸâ”€â”€> completed
   â†‘                                         â”‚
   â”‚                    â†“â”€â”€å¤±è´¥â”€â”€> error â”€â”€â”€â”€â”˜
   â”‚                                         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ é‡æ–°å¤„ç† â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. æ€§èƒ½ä¼˜åŒ–

### 5.1 å›¾ç‰‡å¤„ç†ä¼˜åŒ–
- ä½¿ç”¨ Web Worker å¤„ç†å¤§æ–‡ä»¶ï¼ˆé¿å…é˜»å¡ä¸»çº¿ç¨‹ï¼‰
- åˆ†æ‰¹å¤„ç†æ‰¹é‡æ“ä½œï¼ˆæ¯æ‰¹10å¼ ï¼‰
- åŠæ—¶é‡Šæ”¾å†…å­˜ï¼ˆ`URL.revokeObjectURL()`ï¼‰
- ä½¿ç”¨ Canvas ç¡¬ä»¶åŠ é€Ÿ

### 5.2 é¡µé¢æ€§èƒ½ä¼˜åŒ–
- æ‡’åŠ è½½ç»„ä»¶ï¼ˆReact.lazyï¼‰
- å›¾ç‰‡åˆ—è¡¨è™šæ‹Ÿæ»šåŠ¨ï¼ˆreact-windowï¼‰
- é˜²æŠ–/èŠ‚æµï¼ˆresizeã€inputç­‰äº‹ä»¶ï¼‰
- ç¼“å­˜å¤„ç†ç»“æœï¼ˆé¿å…é‡å¤å¤„ç†ï¼‰

### 5.3 æ‰“åŒ…ä¼˜åŒ–
- ä»£ç åˆ†å‰²ï¼ˆæŒ‰è·¯ç”±åˆ†å‰²ï¼‰
- Tree-shakingï¼ˆç§»é™¤æœªä½¿ç”¨ä»£ç ï¼‰
- å‹ç¼©æ··æ·†ï¼ˆViteè‡ªåŠ¨å¤„ç†ï¼‰
- èµ„æº CDN åŠ è½½

---

## 6. é”™è¯¯å¤„ç†

### 6.1 é”™è¯¯ç±»å‹

```typescript
// src/types/error.ts

export enum ErrorCode {
  FILE_TOO_LARGE = 'FILE_TOO_LARGE',
  INVALID_FORMAT = 'INVALID_FORMAT',
  PROCESSING_FAILED = 'PROCESSING_FAILED',
  BROWSER_NOT_SUPPORTED = 'BROWSER_NOT_SUPPORTED',
  OUT_OF_MEMORY = 'OUT_OF_MEMORY',
}

export class ImageKitError extends Error {
  code: ErrorCode;
  
  constructor(code: ErrorCode, message: string) {
    super(message);
    this.code = code;
    this.name = 'ImageKitError';
  }
}
```

### 6.2 é”™è¯¯æç¤º

```typescript
const errorMessages = {
  FILE_TOO_LARGE: 'æ–‡ä»¶è¿‡å¤§ï¼Œè¯·é€‰æ‹©å°äº 10MB çš„å›¾ç‰‡',
  INVALID_FORMAT: 'ä¸æ”¯æŒçš„å›¾ç‰‡æ ¼å¼ï¼Œè¯·ä¸Šä¼  JPG/PNG/WebP',
  PROCESSING_FAILED: 'å¤„ç†å¤±è´¥ï¼Œè¯·é‡è¯•',
  BROWSER_NOT_SUPPORTED: 'æ‚¨çš„æµè§ˆå™¨ç‰ˆæœ¬è¿‡ä½ï¼Œè¯·å‡çº§æµè§ˆå™¨',
  OUT_OF_MEMORY: 'å›¾ç‰‡è¿‡å¤§å¯¼è‡´å†…å­˜ä¸è¶³ï¼Œè¯·å‡å°å›¾ç‰‡å°ºå¯¸',
};
```

---

## 7. SEO ä¼˜åŒ–

### 7.1 é¡µé¢å…ƒä¿¡æ¯

```typescript
// æ¯ä¸ªé¡µé¢è®¾ç½® meta æ ‡ç­¾
<Helmet>
  <title>å›¾ç‰‡å‹ç¼© - ImageKit å…è´¹åœ¨çº¿å›¾ç‰‡å¤„ç†å·¥å…·</title>
  <meta name="description" content="å…è´¹åœ¨çº¿å›¾ç‰‡å‹ç¼©å·¥å…·ï¼Œæ”¯æŒ JPGã€PNGã€WebP æ ¼å¼ï¼Œæœ¬åœ°å¤„ç†ä¿æŠ¤éšç§ï¼Œæ¯” TinyPNG æ›´å¼ºå¤§" />
  <meta name="keywords" content="å›¾ç‰‡å‹ç¼©,åœ¨çº¿å‹ç¼©,å…è´¹å›¾ç‰‡å·¥å…·,TinyPNG,å›¾ç‰‡å¤„ç†" />
  <link rel="canonical" href="https://imagekit.com/compress" />
</Helmet>
```

### 7.2 ç»“æ„åŒ–æ•°æ®ï¼ˆSchema.orgï¼‰

```json
{
  "@context": "https://schema.org",
  "@type": "SoftwareApplication",
  "name": "ImageKit",
  "description": "å…è´¹åœ¨çº¿å›¾ç‰‡å¤„ç†å·¥å…·",
  "applicationCategory": "UtilitiesApplication",
  "offers": {
    "@type": "Offer",
    "price": "0"
  }
}
```

---

## 8. éƒ¨ç½²é…ç½®

### 8.1 Vercel éƒ¨ç½²

```json
// vercel.json
{
  "buildCommand": "npm run build",
  "outputDirectory": "dist",
  "framework": "vite",
  "rewrites": [
    { "source": "/(.*)", "destination": "/index.html" }
  ],
  "headers": [
    {
      "source": "/assets/(.*)",
      "headers": [
        {
          "key": "Cache-Control",
          "value": "public, max-age=31536000, immutable"
        }
      ]
    }
  ]
}
```

### 8.2 ç¯å¢ƒå˜é‡

```env
# .env.production
VITE_APP_NAME=ImageKit
VITE_APP_URL=https://imagekit.com
VITE_API_URL=https://api.imagekit.com (åæœŸå¦‚æœéœ€è¦)
```

---

## 9. æµ‹è¯•ç­–ç•¥

### 9.1 å•å…ƒæµ‹è¯•
- ä½¿ç”¨ Vitest
- è¦†ç›–æ ¸å¿ƒå·¥å…·å‡½æ•°ï¼ˆcompressã€convertç­‰ï¼‰
- ç›®æ ‡è¦†ç›–ç‡ > 80%

### 9.2 é›†æˆæµ‹è¯•
- ä½¿ç”¨ Playwright
- æµ‹è¯•å®Œæ•´æµç¨‹ï¼ˆä¸Šä¼  â†’ å¤„ç† â†’ ä¸‹è½½ï¼‰
- æµ‹è¯•ä¸åŒæµè§ˆå™¨å…¼å®¹æ€§

### 9.3 æ€§èƒ½æµ‹è¯•
- æµ‹è¯•ä¸åŒå¤§å°å›¾ç‰‡å¤„ç†é€Ÿåº¦
- æµ‹è¯•æ‰¹é‡å¤„ç†ï¼ˆ10ã€50ã€100å¼ ï¼‰
- å†…å­˜æ³„æ¼æ£€æµ‹

---

## 10. ç›‘æ§ä¸åˆ†æ

### 10.1 ç”¨æˆ·è¡Œä¸ºåˆ†æ
- Google Analytics 4
- è¿½è¸ªå…³é”®äº‹ä»¶ï¼š
  - ä¸Šä¼ å›¾ç‰‡
  - ä½¿ç”¨å·¥å…·
  - ä¸‹è½½å›¾ç‰‡
  - åˆ†äº«

### 10.2 æ€§èƒ½ç›‘æ§
- Vercel Analyticsï¼ˆè‡ªå¸¦ï¼‰
- ç›‘æ§æŒ‡æ ‡ï¼š
  - é¡µé¢åŠ è½½æ—¶é—´
  - é¦–æ¬¡å†…å®¹ç»˜åˆ¶ï¼ˆFCPï¼‰
  - æœ€å¤§å†…å®¹ç»˜åˆ¶ï¼ˆLCPï¼‰

### 10.3 é”™è¯¯ç›‘æ§
- Sentryï¼ˆå¯é€‰ï¼‰
- æ•è·è¿è¡Œæ—¶é”™è¯¯
- ç”¨æˆ·åé¦ˆæ”¶é›†

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.2  
**åˆ›å»ºæ—¶é—´**ï¼š2024-11-30  
**æ›´æ–°æ—¶é—´**ï¼š2024-11-30  

---

## æ›´æ–°æ—¥å¿—

### v1.2 (2024-11-30)

**æ‰€æœ‰åŠŸèƒ½æ¨¡å—å·²å®Œæˆ**ï¼š

1. **æ ¼å¼è½¬æ¢æ¨¡å—**
   - æ”¯æŒ JPGã€PNGã€WebP äº’è½¬
   - è´¨é‡å¯è°ƒèŠ‚ï¼ˆJPG/WebPï¼š1-100%ï¼‰
   - PNG æ— æŸè½¬æ¢ä¿æŒé€æ˜åº¦
   - æ‰¹é‡è½¬æ¢ + æ‰¹é‡ä¸‹è½½ZIP
   - é‡æ–°è½¬æ¢æ”¯æŒ
   - ç½‘æ ¼/åˆ—è¡¨åŒè§†å›¾

2. **å°ºå¯¸è°ƒæ•´æ¨¡å—**
   - æŒ‡å®šå°ºå¯¸æ¨¡å¼ï¼ˆåƒç´ ç²¾ç¡®è°ƒæ•´ï¼‰
   - ç¼©æ”¾æ¯”ä¾‹æ¨¡å¼ï¼ˆç™¾åˆ†æ¯”è°ƒæ•´ï¼‰
   - ä¿æŒå®½é«˜æ¯”å¼€å…³
   - å¿«é€Ÿé¢„è®¾å°ºå¯¸ï¼ˆ1920Ã—1080ç­‰ï¼‰
   - å¿«é€Ÿé¢„è®¾æ¯”ä¾‹ï¼ˆ200%/150%/100%ç­‰ï¼‰
   - æ‰¹é‡è°ƒæ•´æ”¯æŒ
   - é‡æ–°è°ƒæ•´æ”¯æŒ

3. **è£å‰ªæ¨¡å—**
   - ä½¿ç”¨ react-image-crop å¯è§†åŒ–è£å‰ªæ¡†
   - æ‹–æ‹½å››ä¸ªè§’è°ƒæ•´å¤§å°
   - æ¯”ä¾‹é¢„è®¾ï¼ˆè‡ªç”±/1:1/16:9/4:3/3:2/9:16ï¼‰
   - æ—‹è½¬æ”¯æŒï¼ˆ0-360Â°ï¼‰
   - ç¼©æ”¾æ”¯æŒï¼ˆ0.5x-3xï¼‰
   - æ ¼å¼è½¬æ¢ï¼ˆåŸæ ¼å¼/JPG/PNG/WebPï¼‰
   - è´¨é‡è°ƒèŠ‚ï¼ˆJPG/WebPï¼‰
   - æ‹–æ‹½ä¸Šä¼  + ç‚¹å‡»ä¸Šä¼ 
   - è£å‰ªèƒŒæ™¯å›¾æ¡ˆï¼ˆcropBg.pngï¼‰

4. **æ°´å°æ¨¡å—** âœ¨æ–°å¢
   - æ–‡å­—æ°´å°ï¼ˆå¯è°ƒå­—å·12-120pxã€é¢œè‰²ã€é€æ˜åº¦ï¼‰
   - å›¾ç‰‡æ°´å°ï¼ˆå¯è°ƒå¤§å°10-100%ã€é€æ˜åº¦ï¼‰
   - 5ç§ä½ç½®é€‰æ‹©ï¼ˆå·¦ä¸Š/å³ä¸Š/å·¦ä¸‹/å³ä¸‹/å±…ä¸­ï¼‰
   - åç§»é‡å¾®è°ƒï¼ˆæ°´å¹³/å‚ç›´ï¼‰
   - æ‰¹é‡æ·»åŠ æ°´å°
   - é‡æ–°æ·»åŠ æ”¯æŒ
   - ç½‘æ ¼/åˆ—è¡¨åŒè§†å›¾

5. **é€šç”¨åŠŸèƒ½**
   - æ‰€æœ‰æ¨¡å—æ”¯æŒæ‹–æ‹½ä¸Šä¼ 
   - æ‰€æœ‰æ¨¡å—æ”¯æŒæ‰¹é‡å¤„ç†
   - æ‰€æœ‰æ¨¡å—æ”¯æŒé‡æ–°å¤„ç†
   - å•å¼ ä¸‹è½½ + æ‰¹é‡ä¸‹è½½ZIP
   - ç½‘æ ¼/åˆ—è¡¨è§†å›¾åˆ‡æ¢
   - å®æ—¶è¿›åº¦æ˜¾ç¤º
   - å®Œæ•´çš„é”™è¯¯å¤„ç†

6. **æŠ€æœ¯æ¶æ„**
   - å‹ç¼©ï¼šbrowser-image-compression + æ™ºèƒ½åˆ†çº§ç­–ç•¥
   - è½¬æ¢ï¼šçº¯ Canvas API
   - è°ƒæ•´ï¼šCanvasé«˜è´¨é‡ç¼©æ”¾
   - è£å‰ªï¼šreact-image-crop + Canvasæ—‹è½¬å˜æ¢
   - æ°´å°ï¼šCanvasæ–‡å­—/å›¾ç‰‡ç»˜åˆ¶ + ä½ç½®è®¡ç®—
   - çŠ¶æ€ç®¡ç†ï¼šZustand
   - UIç»„ä»¶ï¼šshadcn/ui + TailwindCSS
   - è·¯ç”±ï¼šReact Router 6

---

### v1.1 (2024-11-30)

**å‹ç¼©æ¨¡å—é‡å¤§æ›´æ–°**ï¼š

1. **æ™ºèƒ½å‹ç¼©ç®—æ³•**
   - æ–°å¢åˆ†çº§å‹ç¼©ç­–ç•¥ï¼ˆå¤§/ä¸­/å°æ–‡ä»¶ä¸åŒå¤„ç†ï¼‰
   - æ–°å¢äºŒæ¬¡å‹ç¼©æœºåˆ¶ï¼ˆç¡®ä¿ç†æƒ³å‹ç¼©ç‡ï¼‰
   - æ–°å¢è¾“å‡ºæ ¼å¼æ”¯æŒï¼ˆJPG/PNG/WebP/åŸæ ¼å¼ï¼‰

2. **ç”¨æˆ·ä½“éªŒä¼˜åŒ–**
   - æ–°å¢å¿«é€Ÿé¢„è®¾ï¼ˆé«˜è´¨é‡/æ ‡å‡†/é«˜å‹ç¼©ï¼‰
   - æ–°å¢åŒè§†å›¾æ¨¡å¼ï¼ˆç½‘æ ¼/åˆ—è¡¨ï¼‰
   - æ–°å¢å•å¼ ä¸‹è½½åŠŸèƒ½
   - æ–°å¢é‡æ–°å‹ç¼©æ”¯æŒï¼ˆå‚æ•°ä¿®æ”¹åå¯é‡æ–°å¤„ç†ï¼‰
   - æ–°å¢æ™ºèƒ½æç¤ºï¼ˆå®æ—¶å¼•å¯¼ç”¨æˆ·æ“ä½œï¼‰

3. **ç§»åŠ¨ç«¯é€‚é…**
   - å®Œæ•´çš„å“åº”å¼è®¾è®¡
   - è§¦æ‘¸å‹å¥½çš„äº¤äº’
   - æ±‰å ¡èœå•å¯¼èˆª
   - ç§»åŠ¨ç«¯ä¼˜åŒ–å¸ƒå±€

4. **æ€§èƒ½ä¼˜åŒ–**
   - éšè—æ»šåŠ¨æ¡ä½†ä¿æŒæ»šåŠ¨åŠŸèƒ½
   - å‹ç¼©æ—¶ç›´æ¥ä½¿ç”¨ç›®æ ‡æ ¼å¼ï¼ˆé¿å…äºŒæ¬¡è½¬æ¢ï¼‰
   - ä¼˜åŒ–æŒ‰é’®å¸ƒå±€å’Œæ–‡æ¡ˆ

5. **æŠ€æœ¯æ”¹è¿›**
   - ç§»é™¤ Fabric.js ä¾èµ–ï¼ˆæ”¹ç”¨çº¯ Canvas APIï¼‰
   - ä¼˜åŒ–ä¾èµ–åŒ…å®‰è£…ï¼ˆä½¿ç”¨é•œåƒæºï¼‰
   - å®Œå–„ TypeScript ç±»å‹å®šä¹‰
